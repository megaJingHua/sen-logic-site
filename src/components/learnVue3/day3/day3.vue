<template>
  <MobileOnly>
    <div
      class="learn-page min-h-screen bg-[#f8f8e8] py-8 px-2 flex flex-col items-center font-sans text-[#2f5133]"
    >
      <div class="w-full text-left text-justify">
        <div class="title-row">
          <RouterLink to="/mom-share" class="back-icon-btn" aria-label="å›é¦–é ">
            <!-- ä½¿ç”¨ SVG icon -->
            <svg
              width="20"
              height="20"
              viewBox="0 0 28 24"
              fill="none"
              stroke="#4b814b"
              stroke-width="3"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M15 18l-6-6 6-6" />
            </svg>
          </RouterLink>
          <h2 class="text-2xl md:text-4xl font-bold">
            Day3 computed å’Œ watch æ€éº¼å¹«ä½ ã€Œçœ‹å®¶ã€ï¼Ÿ
          </h2>
        </div>
        <div class="day-content mb-4 text-[#3a5a40]">
          åª½åª½æ¯å¤©æœ€æ€•ä»€éº¼ï¼Ÿå°±æ˜¯ã€Œé‡è¤‡å•å•é¡Œã€é‡è¤‡åšäº‹æƒ…ã€ã€‚é›»é‹è¦ç…®é£¯ â†’
          çœ‹ç‡ˆè®Šæ²’ï¼Ÿå°å­©æ´—å®Œæ¾¡ â†’
          åœ°ä¸Šæ¿•æ²’ï¼Ÿé€™äº›ã€Œé‡è¤‡æª¢æŸ¥ã€ã€ã€Œè‡ªå‹•åæ‡‰ã€çš„äº‹ï¼ŒVue
          ä¹Ÿæœ‰å–”ï¼ä»Šå¤©è¦èªè­˜å…©å€‹ Vue çš„å°å¹«æ‰‹ï¼šcomputed å’Œ watch<br />
          <h2 class="text-xl font-bold text-[#4b814b] mt-6 mb-2">
            ğŸ§  computed vs watch æ€éº¼é¸ï¼Ÿ
          </h2>

          <ul>
            <li>
              <strong>computed â†’</strong>
              å¹«ä½ <strong>è‡ªå‹•ç®—å¥½æ±è¥¿</strong>ï¼ˆåƒå¹«ä½ çµ±è¨ˆä»Šå¤©å¹¾ä»¶äº‹å®Œæˆï¼‰ï¼Œé©åˆç”¨ä¾†"é¡¯ç¤ºçµ¦ä½¿ç”¨è€…çœ‹çš„å€¼"ã€‚<br />âœ…
              æœ‰å¿«å–ï¼šä¾è³´çš„è³‡æ–™æ²’è®Šå°±ä¸é‡ç®—<br /><br />
            </li>
            <li>
              <strong>watch â†’</strong>
              å¹«ä½ <strong>å·å·ç›¯è‘—è³‡æ–™ï¼Œä¸€è®Šå°±æé†’ä½ </strong>ï¼ˆåƒä½ çœ‹åˆ°å¤©é»‘äº†æœƒè¨˜å¾—æ”¶è¡£æœï¼‰ï¼Œå¸¸ç”¨åœ¨åŸ·è¡Œå‹•ä½œã€æ›´æ–°è³‡æ–™ã€debugã€‚<br />âŒ
              æ²’æœ‰å¿«å–ï¼Œæ¯æ¬¡è®Šéƒ½åŸ·è¡Œ
            </li>
          </ul>
          <p></p>
          <h2 class="text-xl font-bold text-[#4b814b] mt-6 mb-2">
            ğŸ“¦ä»Šå¤©çš„å¯¦ä½œæ˜¯ä»€éº¼?
          </h2>
          <p>
            å†ä¾†ä¸€æ¬¡ Todo
            Listï¼Œæ–°å¢åŠŸèƒ½è®“æ¯ä»¶ä»£è¾¦äº‹é …éƒ½å¯ä»¥æ‰“å‹¾âœ”ï¸ï¼Œå®Œæˆå¾Œç•«ç·šï½<br />
          </p>
          <b>å°åŠŸèƒ½ Demo:</b> <br />
          <div
            class="demo-block bg-[#f8f8e8] rounded-lg p-4 overflow-x-auto text-sm mb-4"
          >
            <div class="todo">
              <input
                v-model="newTodo"
                placeholder="è¼¸å…¥å¾…è¾¦äº‹é …"
                @keyup.enter="addTodo"
              />
              <button @click="addTodo">æ–°å¢</button>

              <ul>
                <TodoItem
                  v-for="todo in filteredTodos"
                  :key="todo.text"
                  :item="todo"
                  :index="getTodoIndex(todo)"
                  @update="updateTodo"
                  @remove="removeTodo"
                />
              </ul>
            </div>
          </div>
          <b>ç¨‹å¼ç¢¼ Demo:</b> <br />
          éœ€è¦å…©å€‹.vue æª”æ¡ˆï¼Œä¸€å€‹æ˜¯çˆ¶çµ„ä»¶ï¼Œä¸€å€‹æ˜¯å­çµ„ä»¶ã€‚<br />
          <br />
          <strong>Todo.vue (çˆ¶çµ„ä»¶)</strong>
          <pre
            v-pre
            class="code-block bg-[#1e1e1e] rounded-lg p-4 overflow-x-auto text-sm mb-4 text-white"
          ><code><span style="color: #569cd6;">&lt;template&gt;</span>
  <span style="color: #569cd6;">&lt;div</span> <span style="color: #9cdcfe;">class</span>=<span style="color: #ce9178;">"todo"</span><span style="color: #569cd6;">&gt;</span>
    <span style="color: #569cd6;">&lt;input</span>
      <span style="color: #9cdcfe;">v-model</span>=<span style="color: #ce9178;">"newTodo"</span>
      <span style="color: #9cdcfe;">placeholder</span>=<span style="color: #ce9178;">"è¼¸å…¥å¾…è¾¦äº‹é …"</span>
      <span style="color: #9cdcfe;">@keyup.enter</span>=<span style="color: #ce9178;">"addTodo"</span>
    <span style="color: #569cd6;">/&gt;</span>
    <span style="color: #569cd6;">&lt;button</span> <span style="color: #9cdcfe;">@click</span>=<span style="color: #ce9178;">"addTodo"</span><span style="color: #569cd6;">&gt;</span>æ–°å¢<span style="color: #569cd6;">&lt;/button&gt;</span>

    <span style="color: #569cd6;">&lt;ul&gt;</span>
      <span style="color: #569cd6;">&lt;TodoItem</span>
        <span style="color: #9cdcfe;">v-for</span>=<span style="color: #ce9178;">"todo in filteredTodos"</span>
        <span style="color: #9cdcfe;">:key</span>=<span style="color: #ce9178;">"todo.text"</span>
        <span style="color: #9cdcfe;">:item</span>=<span style="color: #ce9178;">"todo"</span>
        <span style="color: #9cdcfe;">:index</span>=<span style="color: #ce9178;">"getTodoIndex(todo)"</span>
        <span style="color: #9cdcfe;">@update</span>=<span style="color: #ce9178;">"updateTodo"</span>
        <span style="color: #9cdcfe;">@remove</span>=<span style="color: #ce9178;">"removeTodo"</span>
      <span style="color: #569cd6;">/&gt;</span>
    <span style="color: #569cd6;">&lt;/ul&gt;</span>
  <span style="color: #569cd6;">&lt;/div&gt;</span>
<span style="color: #569cd6;">&lt;/template&gt;</span>

<span style="color: #569cd6;">&lt;script</span> <span style="color: #9cdcfe;">setup</span><span style="color: #569cd6;">&gt;</span>
<span style="color: #6a9955; font-style: italic;">// æ–°å¢ä»»å‹™çš„è¼¸å…¥æ¡†</span>
<span style="color: #569cd6;">const</span> <span style="color: #9cdcfe;">newTodo</span> = <span style="color: #dcdcaa;">ref</span>(<span style="color: #ce9178;">""</span>)<span style="color: #569cd6;">;</span>

<span style="color: #6a9955; font-style: italic;">// ä»£è¾¦äº‹é …æ¸…å–®</span>
<span style="color: #569cd6;">const</span> <span style="color: #9cdcfe;">todos</span> = <span style="color: #dcdcaa;">ref</span>([
  { <span style="color: #9cdcfe;">text</span>: <span style="color: #ce9178;">"è²·ç‰›å¥¶"</span>, <span style="color: #9cdcfe;">done</span>: <span style="color: #dcdcaa;">false</span> },
  { <span style="color: #9cdcfe;">text</span>: <span style="color: #ce9178;">"å¯« Vue 3 ç­†è¨˜"</span>, <span style="color: #9cdcfe;">done</span>: <span style="color: #dcdcaa;">true</span> },
])<span style="color: #569cd6;">;</span>

<span style="color: #6a9955; font-style: italic;">// åŠ å…¥æ–°ä»»å‹™</span>
<span style="color: #569cd6;">function</span> <span style="color: #dcdcaa;">addTodo</span>() {
  <span style="color: #569cd6;">if</span> (<span style="color: #9cdcfe;">newTodo</span>.<span style="color: #9cdcfe;">value</span>.<span style="color: #dcdcaa;">trim</span>() !== <span style="color: #ce9178;">""</span>) {
    <span style="color: #9cdcfe;">todos</span>.<span style="color: #9cdcfe;">value</span>.<span style="color: #dcdcaa;">push</span>({ <span style="color: #9cdcfe;">text</span>: <span style="color: #9cdcfe;">newTodo</span>.<span style="color: #9cdcfe;">value</span>.<span style="color: #dcdcaa;">trim</span>(), <span style="color: #9cdcfe;">done</span>: <span style="color: #dcdcaa;">false</span> })<span style="color: #569cd6;">;</span>
    <span style="color: #9cdcfe;">newTodo</span>.<span style="color: #9cdcfe;">value</span> = <span style="color: #ce9178;">""</span><span style="color: #569cd6;">;</span>
  }
}

<span style="color: #6a9955; font-style: italic;">// æ›´æ–°å®Œæˆç‹€æ…‹</span>
<span style="color: #569cd6;">function</span> <span style="color: #dcdcaa;">updateTodo</span>(<span style="color: #9cdcfe;">newTodo</span>) {
  <span style="color: #569cd6;">if</span> (!<span style="color: #9cdcfe;">todos</span>.<span style="color: #9cdcfe;">value</span> || !<span style="color: #9cdcfe;">newTodo</span>) <span style="color: #569cd6;">return</span><span style="color: #569cd6;">;</span>
  <span style="color: #569cd6;">const</span> <span style="color: #9cdcfe;">index</span> = <span style="color: #9cdcfe;">todos</span>.<span style="color: #9cdcfe;">value</span>.<span style="color: #dcdcaa;">findIndex</span>((<span style="color: #9cdcfe;">todo</span>) =&gt; <span style="color: #9cdcfe;">todo</span>.<span style="color: #9cdcfe;">text</span> === <span style="color: #9cdcfe;">newTodo</span>.<span style="color: #9cdcfe;">text</span>)<span style="color: #569cd6;">;</span>
  <span style="color: #569cd6;">if</span> (<span style="color: #9cdcfe;">index</span> !== -<span style="color: #b5cea8;">1</span>) {
    <span style="color: #9cdcfe;">todos</span>.<span style="color: #9cdcfe;">value</span>[<span style="color: #9cdcfe;">index</span>] = <span style="color: #9cdcfe;">newTodo</span><span style="color: #569cd6;">;</span>
  }
}

<span style="color: #6a9955; font-style: italic;">// ç§»é™¤ä»»å‹™</span>
<span style="color: #569cd6;">function</span> <span style="color: #dcdcaa;">removeTodo</span>(<span style="color: #9cdcfe;">index</span>) {
  <span style="color: #569cd6;">if</span> (!<span style="color: #9cdcfe;">todos</span>.<span style="color: #9cdcfe;">value</span> || <span style="color: #9cdcfe;">index</span> === -<span style="color: #b5cea8;">1</span> || <span style="color: #9cdcfe;">index</span> &gt;= <span style="color: #9cdcfe;">todos</span>.<span style="color: #9cdcfe;">value</span>.<span style="color: #9cdcfe;">length</span>) <span style="color: #569cd6;">return</span><span style="color: #569cd6;">;</span>
  <span style="color: #9cdcfe;">todos</span>.<span style="color: #9cdcfe;">value</span>.<span style="color: #dcdcaa;">splice</span>(<span style="color: #9cdcfe;">index</span>, <span style="color: #b5cea8;">1</span>)<span style="color: #569cd6;">;</span>
}

<span style="color: #6a9955; font-style: italic;">// âœ… åªé¡¯ç¤ºæœªå®Œæˆçš„åŠŸèƒ½</span>
<span style="color: #569cd6;">const</span> <span style="color: #9cdcfe;">showOnlyUnfinished</span> = <span style="color: #dcdcaa;">ref</span>(<span style="color: #dcdcaa;">false</span>)<span style="color: #569cd6;">;</span>
<span style="color: #569cd6;">const</span> <span style="color: #9cdcfe;">filteredTodos</span> = <span style="color: #dcdcaa;">computed</span>(() =&gt; {
  <span style="color: #569cd6;">return</span> <span style="color: #9cdcfe;">showOnlyUnfinished</span>.<span style="color: #9cdcfe;">value</span>
    ? <span style="color: #9cdcfe;">todos</span>.<span style="color: #9cdcfe;">value</span>.<span style="color: #dcdcaa;">filter</span>((<span style="color: #9cdcfe;">t</span>) =&gt; !<span style="color: #9cdcfe;">t</span>.<span style="color: #9cdcfe;">done</span>)
    : <span style="color: #9cdcfe;">todos</span>.<span style="color: #9cdcfe;">value</span><span style="color: #569cd6;">;</span>
})<span style="color: #569cd6;">;</span>

<span style="color: #6a9955; font-style: italic;">// å®‰å…¨åœ°ç²å– todo çš„ç´¢å¼•</span>
<span style="color: #569cd6;">function</span> <span style="color: #dcdcaa;">getTodoIndex</span>(<span style="color: #9cdcfe;">todo</span>) {
  <span style="color: #569cd6;">if</span> (!<span style="color: #9cdcfe;">todos</span>.<span style="color: #9cdcfe;">value</span>) <span style="color: #569cd6;">return</span> -<span style="color: #b5cea8;">1</span><span style="color: #569cd6;">;</span>
  <span style="color: #569cd6;">return</span> <span style="color: #9cdcfe;">todos</span>.<span style="color: #9cdcfe;">value</span>.<span style="color: #dcdcaa;">findIndex</span>((<span style="color: #9cdcfe;">t</span>) =&gt; <span style="color: #9cdcfe;">t</span>.<span style="color: #9cdcfe;">text</span> === <span style="color: #9cdcfe;">todo</span>.<span style="color: #9cdcfe;">text</span>)<span style="color: #569cd6;">;</span>
}
<span style="color: #569cd6;">&lt;/script&gt;</span></code>
            </pre>
          <strong>TodoItem.vue (å­çµ„ä»¶)</strong>
          <pre
            v-pre
            class="code-block bg-[#1e1e1e] rounded-lg p-4 overflow-x-auto text-sm mb-4 text-white"
          ><code><span style="color: #569cd6;">&lt;template&gt;</span>
  <span style="color: #569cd6;">&lt;li</span><span style="color: #569cd6;">&gt;</span>
    <span style="color: #569cd6;">&lt;input</span> <span style="color: #9cdcfe;">type</span>=<span style="color: #ce9178;">"checkbox"</span> <span style="color: #9cdcfe;">v-model</span>=<span style="color: #ce9178;">"localDone"</span> <span style="color: #9cdcfe;">@change</span>=<span style="color: #ce9178;">"toggleDone"</span> <span style="color: #569cd6;">/&gt;</span>
    <span style="color: #569cd6;">&lt;span</span> <span style="color: #9cdcfe;">:style</span>=<span style="color: #ce9178;">"{ textDecoration: localDone ? 'line-through' : 'none' }"</span><span style="color: #569cd6;">&gt;</span>
      {{ <span style="color: #9cdcfe;">item</span>.<span style="color: #9cdcfe;">text</span> }}
    <span style="color: #569cd6;">&lt;/span</span><span style="color: #569cd6;">&gt;</span>
    <span style="color: #569cd6;">&lt;button</span> <span style="color: #9cdcfe;">@click</span>=<span style="color: #ce9178;">"$emit('remove', props.index)"</span><span style="color: #569cd6;">&gt;</span>âŒ<span style="color: #569cd6;">&lt;/button</span><span style="color: #569cd6;">&gt;</span>
  <span style="color: #569cd6;">&lt;/li</span><span style="color: #569cd6;">&gt;</span>
<span style="color: #569cd6;">&lt;/template</span><span style="color: #569cd6;">&gt;</span>

<span style="color: #569cd6;">&lt;script</span> <span style="color: #9cdcfe;">setup</span><span style="color: #569cd6;">&gt;</span>
<span style="color: #569cd6;">import</span> { <span style="color: #dcdcaa;">ref</span>, <span style="color: #dcdcaa;">watch</span> } <span style="color: #569cd6;">from</span> <span style="color: #ce9178;">"vue"</span><span style="color: #569cd6;">;</span>
<span style="color: #6a9955; font-style: italic;">// æ¥æ”¶çˆ¶æ¯äº¤ä»£çš„ props èˆ‡ emit</span>
<span style="color: #569cd6;">const</span> <span style="color: #9cdcfe;">props</span> = <span style="color: #dcdcaa;">defineProps</span>([<span style="color: #ce9178;">"item"</span>, <span style="color: #ce9178;">"index"</span>])<span style="color: #569cd6;">;</span>
<span style="color: #569cd6;">const</span> <span style="color: #9cdcfe;">emit</span> = <span style="color: #dcdcaa;">defineEmits</span>([<span style="color: #ce9178;">"update"</span>, <span style="color: #ce9178;">"remove"</span>])<span style="color: #569cd6;">;</span>

<span style="color: #569cd6;">const</span> <span style="color: #9cdcfe;">localDone</span> = <span style="color: #dcdcaa;">ref</span>(<span style="color: #9cdcfe;">props</span>.<span style="color: #9cdcfe;">item</span>.<span style="color: #9cdcfe;">done</span>)<span style="color: #569cd6;">;</span>

<span style="color: #6a9955; font-style: italic;">// çœ‹è‘— props çš„ doneï¼Œæœ‰è®Šå°±åŒæ­¥æ›´æ–° localDone</span>
<span style="color: #dcdcaa;">watch</span>(
  () <span style="color: #569cd6;">=&gt;</span> <span style="color: #9cdcfe;">props</span>.<span style="color: #9cdcfe;">item</span>.<span style="color: #9cdcfe;">done</span>,
  (<span style="color: #9cdcfe;">newVal</span>) <span style="color: #569cd6;">=&gt;</span> {
    <span style="color: #9cdcfe;">localDone</span>.<span style="color: #9cdcfe;">value</span> = <span style="color: #9cdcfe;">newVal</span><span style="color: #569cd6;">;</span>
  }
)<span style="color: #569cd6;">;</span>

<span style="color: #6a9955; font-style: italic;">// ä½¿ç”¨è€…æ‰“å‹¾æ™‚ï¼Œå‘Šè¨´çˆ¶æ¯ã€Œæˆ‘è®Šå¥½äº†ã€</span>
<span style="color: #569cd6;">function</span> <span style="color: #dcdcaa;">toggleDone</span>() {
  <span style="color: #dcdcaa;">emit</span>(<span style="color: #ce9178;">"update"</span>, { ...<span style="color: #9cdcfe;">props</span>.<span style="color: #9cdcfe;">item</span>, <span style="color: #9cdcfe;">done</span>: <span style="color: #9cdcfe;">localDone</span>.<span style="color: #9cdcfe;">value</span> })<span style="color: #569cd6;">;</span>
}
<span style="color: #569cd6;">&lt;/script</span><span style="color: #569cd6;">&gt;</span></code>
           </pre>
        </div>
      </div>
    </div>
  </MobileOnly>
</template>

<script setup>
import { ref, computed } from "vue";
import TodoItem from "./todoListItem.vue";

// æ–°å¢ä»»å‹™çš„è¼¸å…¥æ¡†
const newTodo = ref("");

// ä»£è¾¦äº‹é …æ¸…å–®
const todos = ref([
  { text: "è²·ç‰›å¥¶", done: false },
  { text: "å¯« Vue 3 ç­†è¨˜", done: true },
]);

// åŠ å…¥æ–°ä»»å‹™
function addTodo() {
  if (newTodo.value.trim() !== "") {
    todos.value.push({ text: newTodo.value.trim(), done: false });
    newTodo.value = "";
  }
}

// æ›´æ–°å®Œæˆç‹€æ…‹
function updateTodo(newTodo) {
  if (!todos.value || !newTodo) return;
  const index = todos.value.findIndex((todo) => todo.text === newTodo.text);
  if (index !== -1) {
    todos.value[index] = newTodo;
  }
}

// ç§»é™¤ä»»å‹™
function removeTodo(index) {
  if (!todos.value || index === -1 || index >= todos.value.length) return;
  todos.value.splice(index, 1);
}

// âœ… åªé¡¯ç¤ºæœªå®Œæˆçš„åŠŸèƒ½
const showOnlyUnfinished = ref(false);
const filteredTodos = computed(() => {
  return showOnlyUnfinished.value
    ? todos.value.filter((t) => !t.done)
    : todos.value;
});

// å®‰å…¨åœ°ç²å– todo çš„ç´¢å¼•
function getTodoIndex(todo) {
  if (!todos.value) return -1;
  return todos.value.findIndex((t) => t.text === todo.text);
}
</script>

<style scoped>
.todo {
  max-width: 400px;
  margin: auto;
}
input {
  padding: 8px;
  width: 70%;
  margin-right: 8px;
}
button {
  padding: 8px 12px;
}
ul {
  list-style-type: none;
  padding: 0;
}
h3 {
  color: #42b983;
}
h3,
h2 {
  color: #42b983;
  margin-top: 10px;
}

p {
  padding-left: 20px;
}
</style>